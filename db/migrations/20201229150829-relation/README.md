# Migration `20201229150829-relation`

This migration has been generated by hewel at 12/29/2020, 11:08:29 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "Company" DROP CONSTRAINT "Company_companyId_fkey"

ALTER TABLE "Company" DROP COLUMN "companyId",
ADD COLUMN     "parentCompanyId" INTEGER

CREATE UNIQUE INDEX "Company.tmdbId_unique" ON "Company"("tmdbId")

CREATE UNIQUE INDEX "Movie.tmdbId_unique" ON "Movie"("tmdbId")

ALTER TABLE "Company" ADD FOREIGN KEY("parentCompanyId")REFERENCES "Company"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201229144809-unique..20201229150829-relation
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -59,19 +59,19 @@
   doubanRate  Int?
 }
 model Company {
-  id            Int       @id @default(autoincrement())
-  createdAt     DateTime  @default(now())
-  updatedAt     DateTime  @updatedAt
-  name          String
-  description   String?
-  tmdbId        Int       @unique
-  region        Region?
-  parentCompany Company?  @relation("CompanyToCompany", fields: [companyId], references: [id])
-  movies        Movie[]   @relation(references: [id])
-  subsidiaries  Company[] @relation("CompanyToCompany")
-  companyId     Int?
+  id              Int       @id @default(autoincrement())
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
+  name            String
+  description     String?
+  tmdbId          Int       @unique
+  region          Region?
+  parentCompany   Company?  @relation("CompanyToCompany", fields: [parentCompanyId], references: [id])
+  movies          Movie[]   @relation(references: [id])
+  subsidiaries    Company[] @relation("CompanyToCompany")
+  parentCompanyId Int?
 }
 enum Region {
   US
```


